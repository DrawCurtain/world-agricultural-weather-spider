# 世界农业天气数据爬虫

这是一个用于爬取世界农业天气数据的Python爬虫，能够按国家和地区分类下载降水(PCP)和温度(TMP)图片数据。

## 功能特性

- 支持下载5种作物的天气数据：玉米、大豆、小麦、油菜籽、大麦
- 支持两种数据类型：降水(PCP)和温度(TMP)
- 支持三种时间范围：15天预报、60天历史数据、180天历史数据
- 支持按国家和地区分类下载和存储数据
- 提供交互式和命令行两种使用模式
- 具有自动重试机制，提高下载成功率

## 项目结构

```
spiderMan/
├── analyze_website.py    # 网站分析脚本
├── downloader.py         # 下载模块
├── downloads/            # 下载文件存储目录
│   ├── pcp/              # 降水图片
│   └── tmp/              # 温度图片
├── main.py               # 主程序
├── network.py            # 网络请求模块
├── parser.py             # 解析模块
└── website_content.html  # 网站内容备份
```

## 安装依赖

在运行爬虫之前，需要安装以下依赖：

```bash
pip install requests beautifulsoup4
```

## 使用方法

### 1. 交互式模式

直接运行主程序即可进入交互式模式：

```bash
python main.py
```

进入交互式模式后，按照提示输入相应的编号：

1. 输入作物编号（0-4）
2. 输入数据类型编号（0: 降水, 1: 温度）
3. 输入天数编号（1: 15天预报, 2: 60天历史数据, 3: 180天历史数据）
4. 确认下载

### 2. 命令行模式

使用命令行参数直接指定下载参数：

```bash
python main.py -c <作物编号> -d <数据类型编号> -n <天数编号>
```

#### 参数说明

- `-c, --crop`：作物编号（0-4）
  - 0: corn（玉米）
  - 1: soybeans（大豆）
  - 2: wheat（小麦）
  - 3: rapeseed（油菜籽）
  - 4: barley（大麦）

- `-d, --datatype`：数据类型编号
  - 0: PCP（降水）
  - 1: TMP（温度）

- `-n, --days`：天数编号
  - 1: 15天预报
  - 2: 60天历史数据
  - 3: 180天历史数据

#### 示例

下载大豆的15天降水数据：

```bash
python main.py -c 1 -d 0 -n 1
```

下载小麦的60天温度数据：

```bash
python main.py -c 2 -d 1 -n 2
```

## 支持的国家和地区

爬虫支持以下作物的多个国家和地区：

### 玉米 (Corn)
- 美国 (USA)：全国、艾奥瓦州、伊利诺伊州、内布拉斯加州、明尼苏达州、印第安纳州
- 巴西 (Brazil)：全国、巴拉那州、马托格罗索州、米纳斯吉拉斯州、戈亚斯州、南里奥格兰德州
- 阿根廷 (Argentina)：全国、布宜诺斯艾利斯省、科尔多瓦省、圣菲省、恩特雷里奥斯省、圣地亚哥-德尔埃斯特罗省
- 中国 (China)：全国、山东省、黑龙江省、吉林省、河南省、河北省

### 大豆 (Soybeans)
- 美国 (USA)：全国、艾奥瓦州、伊利诺伊州、明尼苏达州、印第安纳州、内布拉斯加州
- 巴西 (Brazil)：全国、马托格罗索州、巴拉那州、南里奥格兰德州、戈亚斯州、南马托格罗索州
- 阿根廷 (Argentina)：全国、布宜诺斯艾利斯省、科尔多瓦省、圣菲省、恩特雷里奥斯省、圣地亚哥-德尔埃斯特罗省

### 小麦 (Wheat)
- 美国 (USA)：爱达荷州、堪萨斯州、明尼苏达州、蒙大拿州、北达科他州、俄克拉荷马州、南达科他州、得克萨斯州、华盛顿州
- 加拿大 (Canada)：全国、阿尔伯塔省、萨斯喀彻温省、曼尼托巴省
- 欧洲 (Europe)：法国、德国、英国、波兰、西班牙
- 乌克兰 (Ukraine)：全国、中部、南部、伏尔加地区、乌拉尔地区、西伯利亚、哈萨克斯坦
- 中国 (China)：全国、河南省、山东省、河北省、安徽省、江苏省
- 澳大利亚 (Australia)：全国、西澳大利亚州、维多利亚州、新南威尔士州
- 印度 (India)：全国

### 油菜籽 (Rapeseed)
- 加拿大 (Canada)：全国、阿尔伯塔省、萨斯喀彻温省、曼尼托巴省
- 欧洲 (Europe)：法国、德国、英国、波兰、捷克

### 大麦 (Barley)
- 加拿大 (Canada)：全国、阿尔伯塔省、萨斯喀彻温省、曼尼托巴省
- 欧洲 (Europe)：法国、德国、西班牙、英国、丹麦

## 下载结果

下载的图片将按照以下规则分类存储：

- **降水图片**：保存在 `downloads/pcp/{日期}/` 目录下
- **温度图片**：保存在 `downloads/tmp/{日期}/` 目录下

其中 `{日期}` 格式为 YYYYMMDD（例如20251216）

文件名格式：`{vrbl}_{cropname}_{regionname}_{subregionname}_{type}.png`

- `{vrbl}`：数据类型（pcp=降水，tmp=温度）
- `{cropname}`：作物名称（如corn, soybeans等）
- `{regionname}`：国家名称（如usa, brazil等）
- `{subregionname}`：地区名称（如iowa, illinois等）
- `{type}`：数据类型（forecast=预报，60day=60天历史，180day=180天历史）

### 目录结构示例

```
downloads/
├── pcp/
│   ├── 20251216/
│   │   ├── pcp_soybeans_usa_usa_forecast.png
│   │   ├── pcp_soybeans_usa_iowa_forecast.png
│   │   └── ...
│   ├── 20251217/
│   │   └── ...
│   └── ...
└── tmp/
    ├── 20251216/
    │   ├── tmp_soybeans_usa_usa_forecast.png
    │   ├── tmp_soybeans_usa_iowa_forecast.png
    │   └── ...
    ├── 20251217/
    │   └── ...
    └── ...
```

下载完成后，程序会显示下载结果统计，包括：
- 总图片数
- 成功下载数
- 下载失败数
- 成功率
- 成功/失败的图片列表

## 注意事项

1. 爬虫会自动获取最新的图片编号，确保下载的是最新数据
2. 图片下载具有重试机制，最多重试3次
3. 下载大量图片时可能会花费较长时间，请耐心等待
4. 请遵守网站的使用条款，不要过度频繁地下载数据
5. 如遇到网络问题，请检查网络连接后重试

## 每日自动汇总功能

### 功能说明

提供了`daily_summary.py`脚本用于实现每日自动爬取大豆作物15天的降水和温度预报，并生成包含今天和前一天对比图的Word文档。

### 使用方法

1. **安装依赖**：
   ```bash
   pip install python-docx
   ```

2. **运行每日汇总脚本**：
   ```bash
   python daily_summary.py
   ```

3. **脚本功能**：
   - 自动下载当天大豆作物的15天降水和温度预报图片
   - 查找当天和前一天的图片对
   - 生成两个Word文档：
     - `weather_summary_pcp_YYYYMMDD.docx` - 降水对比文档
     - `weather_summary_tmp_YYYYMMDD.docx` - 温度对比文档
   - 每个文档包含相同地区的今天和前一天的对比图

### 设置Windows定时任务

1. 打开「任务计划程序」
2. 点击「创建基本任务」
3. 填写任务名称和描述，点击「下一步」
4. 选择「每天」，点击「下一步」
5. 设置开始时间（建议在凌晨），点击「下一步」
6. 选择「启动程序」，点击「下一步」
7. 浏览并选择Python可执行文件，在「添加参数」中输入脚本路径：`daily_summary.py`
8. 在「起始于」中输入脚本所在目录：`E:\spider\spiderMan`
9. 点击「下一步」，然后点击「完成」

### 设置Linux定时任务

1. 打开终端，运行：
   ```bash
   crontab -e
   ```

2. 添加以下行（每天凌晨2点执行）：
   ```
   0 2 * * * cd /path/to/spiderMan && python daily_summary.py
   ```

3. 保存并退出编辑器

## 更新日志

- v1.0.0 (2025-04-14)
  - 初始版本发布
  - 支持5种作物的天气数据下载
  - 提供交互式和命令行两种使用模式
  - 支持按国家和地区分类存储数据

## 许可证

本项目采用MIT许可证，可自由使用和修改。